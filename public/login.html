<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>登录 - GoNews</title>
    <style>
      :root {
        --bg: #f7f7f8;
        --card: #ffffff;
        --text: #222;
        --muted: #666;
        --primary: #ff7aa2;
        --primary-2: #fcbf49;
        --ring: rgba(255, 122, 162, 0.35);
      }
      html, body { height: 100%; }
      body {
        margin: 0; display: grid; place-items: center;
        background: linear-gradient(180deg, #fff, #f6f1f6 60%, #f8fbff);
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        color: var(--text);
      }
      .card {
        width: min(420px, 92vw);
        background: var(--card);
        border-radius: 16px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        padding: 24px;
      }
      h1 { font-size: 20px; margin: 0 0 8px; }
      p.sub { margin: 0 0 16px; color: var(--muted); font-size: 13px; }
      label { display: block; font-size: 12px; color: var(--muted); margin: 12px 0 6px; }
      input[type="text"], input[type="password"] {
        width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb;
        border-radius: 10px; font-size: 14px; outline: none; background: #fafafa;
      }
      input[type="text"]:focus, input[type="password"]:focus { border-color: var(--primary); box-shadow: 0 0 0 3px var(--ring); background: #fff; }
      button {
        width: 100%; margin-top: 16px; padding: 12px 14px; border: none; border-radius: 12px;
        background: linear-gradient(135deg, var(--primary), var(--primary-2)); color: #111;
        font-weight: 600; cursor: pointer; box-shadow: 0 6px 12px rgba(252, 191, 73, .25);
      }
      .error { color: #c0392b; font-size: 13px; min-height: 18px; margin-top: 8px; }
      .hint { font-size: 12px; color: var(--muted); margin-top: 14px; text-align: center; }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>登录 GoNews</h1>
      <p class="sub">请输入在 <code>config.env</code> 中配置的账号与密码。</p>
      <form id="loginForm">
        <label for="username">账号</label>
        <input id="username" name="username" type="text" autocomplete="username" />
        <label for="password">密码</label>
        <input id="password" name="password" type="password" autocomplete="current-password" />
        <button type="submit">登录</button>
        <div id="error" class="error"></div>
      </form>
      <div class="hint">成功登录后将跳转到主页。</div>
    </div>
    <script>
      const form = document.getElementById('loginForm');
      const errorEl = document.getElementById('error');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        errorEl.textContent = '';
        const uEl = document.getElementById('username');
        const pEl = document.getElementById('password');
        const username = uEl instanceof HTMLInputElement ? uEl.value.trim() : '';
        const password = pEl instanceof HTMLInputElement ? pEl.value.trim() : '';
        if (!username || !password) {
          errorEl.textContent = '请输入账号和密码';
          return;
        }
        try {
          const res = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
          });
          if (res.ok) {
            location.href = '/';
          } else {
            const data = await res.json().catch(() => ({}));
            errorEl.textContent = data?.error === 'invalid_credentials' ? '账号或密码错误' : '登录失败';
          }
        } catch (err) {
          errorEl.textContent = '网络错误，请稍后重试';
        }
      });
    </script>
  </body>
  </html>